TRUE ~ "FALSE"),
sql = case_when(`Opportunity ID`!="" ~ "TRUE",
TRUE ~ "FALSE"),
cw = case_when(Stage == "Closed Won" | Stage == "Onboarded" ~ "TRUE",
TRUE ~ "FALSE"),
dm_drop = case_when(`Created Date`<="10/18/2023" ~ "DM1",
TRUE ~ "DM2"))
View(october_leads)
october_leads <- october_leads |>
mutate(`Created Date` = mdy(`Created Date`),
`Mobile - Primary` = str_replace_all(str_replace_all(`Mobile - Primary`, "-", ""), "[^0-9]", ""),
`Business Phone`= str_replace_all(str_replace_all(`Business Phone`, "-", ""), "[^0-9]", ""),
flow = case_when(`Created By` %in% c("JotForm Integration User", "Carlito Academia") ~ "webflow",
TRUE ~ "inbound call"),
types = case_when(`Created By` == "JotForm Integration User" ~ "jotform",
`Created By` == "Carlito Academia" ~ "qr scan",
TRUE ~ "inbound call"),
mql = case_when(`Menu Type` != "" & `State/Province (text only)` != ""
& (`Created By` == "JotForm Integration User" | `Lead Status` %in% c("Converted", "AE Assigned")) &
!(`Unqualified Reason` %in% c("Current Client", "Duplicate", "Not a Restaurant")) ~ "TRUE",
TRUE ~ "FALSE"),
sql = case_when(`Opportunity ID`!="" ~ "TRUE",
TRUE ~ "FALSE"),
cw = case_when(Stage == "Closed Won" | Stage == "Onboarded" ~ "TRUE",
TRUE ~ "FALSE"),
dm_drop = case_when(`Created Date`=<"10/18/2023" ~ "DM1",
gc()
gc()
setwd("~/PerformanceMarketing/Form Submission/2024/January_2024/January_all")
knitr::opts_chunk$set(echo = TRUE)
folder_path <- '~/PerformanceMarketing/Form Submission/2024/January_2024/January_all'
filenames <- list.files(folder_path, pattern = "\\.csv$", full.names = TRUE)
combo_data <- purrr::map_df(filenames,
~read_csv(.x) |> mutate(filename = .x))
library(tidyverse)
library(purrr)
library(dplyr)
folder_path <- '~/PerformanceMarketing/Form Submission/2024/January_2024/January_all'
filenames <- list.files(folder_path, pattern = "\\.csv$", full.names = TRUE)
combo_data <- purrr::map_df(filenames,
~read_csv(.x) |> mutate(filename = .x))
common_path <- dirname(filenames[1])
combo_data <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") ~ "DM")) |>
select(channel, everything(),-"...1",-"...10",-"...12")
View(combo_data)
common_path <- dirname(filenames[1])
combo_data <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") ~ "DM")) |>
select(channel, everything(),-"...1",-"...10",-"...12")
folder_path <- '~/PerformanceMarketing/Form Submission/2024/January_2024/January_all'
filenames <- list.files(folder_path, pattern = "\\.csv$", full.names = TRUE)
combo_data <- purrr::map_df(filenames,
~read_csv(.x) |> mutate(filename = .x))
common_path <- dirname(filenames[1])
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") ~ "DM")) |>
select(channel, everything(),-"...1",-"...10",-"...12")
View(combo_data2)
common_path <- dirname(filenames[1])
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") ~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", `User Agent`,`User IP`,`User ID`))
View(combo_data2)
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") ~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", `User Agent`,`User IP`,`User ID`, `Terms and Conditions`))
View(combo_data2)
common_path <- dirname(filenames[1])
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") ~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", `User Agent`,`User ID`, `Terms and Conditions`))
View(combo_data2)
colnames(combo_data2)
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") ~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", `User Agent`,`User ID`, `Terms and Conditions`))
View(combo_data2)
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)Direct Mail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", `User Agent`,`User ID`, `Terms and Conditions`))
View(combo_data2)
common_path <- dirname(filenames[1])
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", `User Agent`,`User ID`, `Terms and Conditions`))
View(combo_data2)
combo_data |>
group_by(channel) |>
summarize(form_fill_numbers=n()) |>
arrange(desc(form_fill_numbers)) -> summary_table
combo_data2 |>
group_by(channel) |>
summarize(form_fill_numbers=n()) |>
arrange(desc(form_fill_numbers)) -> summary_table
write_csv(summary_table, "form_fill_counts_by_channel.csv")
write_csv(combo_data2,"all_form_fill.csv", na = "")
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", `User Agent`,`User ID`, `Terms and Conditions`)) |>
rename(Create_Date = `Created At`) |>
mutate(Create_Date = as_date(Create_Date))
View(combo_data2)
combo_data2 |>
group_by(channel) |>
summarize(form_fill_numbers=n()) |>
arrange(desc(form_fill_numbers)) -> summary_table
write_csv(summary_table, "form_fill_counts_by_channel.csv")
write_csv(combo_data2,"all_form_fill.csv", na = "")
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12, ...1", `User Agent`,`User ID`, `Terms and Conditions`)) |>
rename(Create_Date = `Created At`) |>
mutate(Create_Date = as_date(Create_Date))
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", "...1", `User Agent`,`User ID`, `Terms and Conditions`)) |>
rename(Create_Date = `Created At`) |>
mutate(Create_Date = as_date(Create_Date))
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`)) |>
rename(Create_Date = `Created At`) |>
mutate(Create_Date = as_date(Create_Date))
View(combo_data2)
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`)) |>
rename(Create_Date = `Created At`) |>
mutate(Create_Date = as_date(Create_Date),
Week = case_when(Create_Date => "1/1/2024" & Create_Date<= "1/7/2024" ~"1/1-1/7",
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`)) |>
rename(Create_Date = `Created At`) |>
mutate(Create_Date = as_date(Create_Date),
Week = case_when(Create_Date >= "1/1/2024" & Create_Date<= "1/7/2024" ~"1/1-1/7",
Create_Date >= "1/8/2024" & Create_Date<= "1/14/2024" ~"1/8-1/14",
Create_Date >= "1/15/2024" & Create_Date<= "1/21/2024" ~"1/15-1/21",
Create_Date >= "1/22/2024" ~"1/22-1/31"))
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`)) |>
rename(Create_Date = `Created At`) |>
mutate(
Create_Date = as_date(Create_Date), # Convert Create_Date to Date if not already in Date format
Week = case_when(
Create_Date >= as_date("2024-01-01") & Create_Date <= as_date("2024-01-07") ~ "1/1-1/7",
Create_Date >= as_date("2024-01-08") & Create_Date <= as_date("2024-01-14") ~ "1/8-1/14",
Create_Date >= as_date("2024-01-15") & Create_Date <= as_date("2024-01-21") ~ "1/15-1/21",
Create_Date >= as_date("2024-01-22") & Create_Date <= as_date("2024-01-31") ~ "1/22-1/31",
TRUE ~ NA_character_ # Default case if no conditions are met
)
)
View(combo_data2)
colnames(combo_data2)
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`,`餐馆名字`,`名字`)) |>
rename(Create_Date = `Created At`) |>
mutate(
Create_Date = as_date(Create_Date), # Convert Create_Date to Date if not already in Date format
Week = case_when(
Create_Date >= as_date("2024-01-01") & Create_Date <= as_date("2024-01-07") ~ "1/1-1/7",
Create_Date >= as_date("2024-01-08") & Create_Date <= as_date("2024-01-14") ~ "1/8-1/14",
Create_Date >= as_date("2024-01-15") & Create_Date <= as_date("2024-01-21") ~ "1/15-1/21",
Create_Date >= as_date("2024-01-22") & Create_Date <= as_date("2024-01-31") ~ "1/22-1/31",
TRUE ~ NA_character_ # Default case if no conditions are met
)
)
View(combo_data2)
common_path <- dirname(filenames[1])
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
rename(Create_Date = `Created At`) |>
mutate(
Create_Date = as_date(Create_Date), # Convert Create_Date to Date if not already in Date format
week = case_when(
Create_Date >= as_date("2024-01-01") & Create_Date <= as_date("2024-01-07") ~ "1/1-1/7",
Create_Date >= as_date("2024-01-08") & Create_Date <= as_date("2024-01-14") ~ "1/8-1/14",
Create_Date >= as_date("2024-01-15") & Create_Date <= as_date("2024-01-21") ~ "1/15-1/21",
Create_Date >= as_date("2024-01-22") & Create_Date <= as_date("2024-01-31") ~ "1/22-1/31",
TRUE ~ NA_character_ # Default case if no conditions are met
)
) |>
select(week, channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`,`餐馆名字`,`名字`)) |>
common_path <- dirname(filenames[1])
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
rename(Create_Date = `Created At`) |>
mutate(
Create_Date = as_date(Create_Date), # Convert Create_Date to Date if not already in Date format
week = case_when(
Create_Date >= as_date("2024-01-01") & Create_Date <= as_date("2024-01-07") ~ "1/1-1/7",
Create_Date >= as_date("2024-01-08") & Create_Date <= as_date("2024-01-14") ~ "1/8-1/14",
Create_Date >= as_date("2024-01-15") & Create_Date <= as_date("2024-01-21") ~ "1/15-1/21",
Create_Date >= as_date("2024-01-22") & Create_Date <= as_date("2024-01-31") ~ "1/22-1/31",
TRUE ~ NA_character_ )) |>
select(week, channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`,`餐馆名字`,`名字`)) |>
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
rename(Create_Date = `Created At`) |>
mutate(
Create_Date = as_date(Create_Date), # Convert Create_Date to Date if not already in Date format
week = case_when(
Create_Date >= as_date("2024-01-01") & Create_Date <= as_date("2024-01-07") ~ "1/1-1/7",
Create_Date >= as_date("2024-01-08") & Create_Date <= as_date("2024-01-14") ~ "1/8-1/14",
Create_Date >= as_date("2024-01-15") & Create_Date <= as_date("2024-01-21") ~ "1/15-1/21",
Create_Date >= as_date("2024-01-22") & Create_Date <= as_date("2024-01-31") ~ "1/22-1/31",
TRUE ~ NA_character_ )) |>
select(week, channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`,`餐馆名字`,`名字`)) |>
```
```{r}
common_path <- dirname(filenames[1])
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
rename(Create_Date = `Created At`) |>
mutate(
Create_Date = as_date(Create_Date), # Convert Create_Date to Date if not already in Date format
week = case_when(
Create_Date >= as_date("2024-01-01") & Create_Date <= as_date("2024-01-07") ~ "1/1-1/7",
Create_Date >= as_date("2024-01-08") & Create_Date <= as_date("2024-01-14") ~ "1/8-1/14",
Create_Date >= as_date("2024-01-15") & Create_Date <= as_date("2024-01-21") ~ "1/15-1/21",
Create_Date >= as_date("2024-01-22") & Create_Date <= as_date("2024-01-31") ~ "1/22-1/31",
TRUE ~ NA_character_ )) |>
select(week, channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`,`餐馆名字`,`名字`)) |>
combo_data2 <- combo_data |>
mutate(filename = as.character(filename)) |>
mutate(filename = str_replace(filename, common_path, ""),
filename = str_remove(filename, "/")) |>
mutate(filename = str_replace_all(filename, "\\([0-9a-f]+\\)-\\d{4}-\\d{2}-\\d{2}\\.csv", "")) |>
rename(phone_number = `手机号码`) |>
mutate(phone_number = str_replace_all(phone_number, "-", "") |>
str_replace_all("[^0-9]", "")) |>
mutate(
channel = case_when(
str_detect(filename, "(?i)SEM|Blog Pages Contact us") | str_detect(utm_source,"(?i)google") ~ "SEM",
str_detect(filename, "(?i)SEO|Contact us") ~ "SEO",
str_detect(filename, "(?i)sMS") ~ "SMS",
str_detect(filename, "(?i)Brizo|(?i)DM") | str_detect(utm_medium,"(?i)DirectMail")~ "DM")) |>
select(channel, everything(),-c("...1","...10","...12", "...11", `User Agent`,`User ID`, `Terms and Conditions`,`餐馆名字`,`名字`)) |>
rename(Create_Date = `Created At`) |>
mutate(
Create_Date = as_date(Create_Date), # Convert Create_Date to Date if not already in Date format
week = case_when(
Create_Date >= as_date("2024-01-01") & Create_Date <= as_date("2024-01-07") ~ "1/1-1/7",
Create_Date >= as_date("2024-01-08") & Create_Date <= as_date("2024-01-14") ~ "1/8-1/14",
Create_Date >= as_date("2024-01-15") & Create_Date <= as_date("2024-01-21") ~ "1/15-1/21",
Create_Date >= as_date("2024-01-22") & Create_Date <= as_date("2024-01-31") ~ "1/22-1/31",
TRUE ~ NA_character_ # Default case if no conditions are met
)
) |>
select(week,channel, everything())
View(combo_data2)
combo_data2 |>
group_by(channel) |>
summarize(form_fill_numbers=n()) |>
arrange(desc(form_fill_numbers)) -> summary_table
write_csv(summary_table, "form_fill_counts_by_channel.csv")
write_csv(combo_data2,"all_form_fill.csv", na = "")
